<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tactical Score Sheet</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { 
      font-family: 'Arial', sans-serif; 
      padding: 20px; 
      max-width: 900px; 
      margin: auto; 
      background-color: #f9f9f9; 
      color: #333; 
    }
    h1 { 
      text-align: center; 
      color: #2c3e50; 
      margin-bottom: 30px; 
    }
    h2 { 
      margin-top: 0; 
      color: #34495e; 
      border-bottom: 2px solid #3498db; 
      padding-bottom: 5px; 
    }
    details.section { 
      margin-bottom: 20px; 
      padding: 15px; 
      border: 1px solid #ddd; 
      border-radius: 8px; 
      background-color: #fff; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
      page-break-before: auto; 
      page-break-inside: avoid; 
    }
    summary { 
      cursor: pointer; 
      color: #3498db; 
      font-weight: bold; 
    }
    .question { 
      display: grid; 
      grid-template-columns: 1fr auto auto; 
      align-items: center; 
      margin-bottom: 15px; 
      column-gap: 15px; 
      page-break-inside: avoid; 
    }
    .buttons, .multi-select { 
      display: flex; 
      gap: 8px; 
      flex-wrap: wrap; 
    }
    input[type="text"], textarea, select { 
      width: 100%; 
      margin-top: 5px; 
      margin-bottom: 10px; 
      padding: 6px; 
      border: 1px solid #ccc; 
      border-radius: 4px; 
      font-size: 14px; 
    }
    .full-width-input { 
      grid-column: 1 / -1; 
      margin-top: 10px; 
    }
    textarea { 
      resize: vertical; 
    }
    .notes { 
      grid-column: 1 / -1; 
      margin-top: 5px; 
    }
    .score, .subscore { 
      font-weight: bold; 
      font-size: 1.2em; 
      margin-top: 20px; 
      page-break-before: avoid; 
    }
    .subscore.red { color: #e74c3c; }
    .subscore.yellow { color: #f1c40f; }
    .subscore.green { color: #2ecc71; }
    button { 
      padding: 6px 12px; 
      cursor: pointer; 
      background-color: #ecf0f1; 
      border: 1px solid #bdc3c7; 
      border-radius: 4px; 
      transition: background-color 0.2s; 
    }
    button:hover { 
      background-color: #dfe6e9; 
    }
    button.selected { 
      background-color: #3498db; 
      color: white; 
      border-color: #2980b9; 
    }
    .controls { 
      margin: 20px 0; 
      text-align: center; 
    }
    .controls button { 
      margin: 0 10px; 
      background-color: #2ecc71; 
      color: white; 
      border: none; 
    }
    .controls button:hover { 
      background-color: #27ae60; 
    }
    .overall-question { 
      margin-bottom: 25px; 
      page-break-inside: avoid; 
    }
    .overall-question label { 
      font-weight: bold; 
    }
    details.grade-details { 
      margin-top: 5px; 
    }
    details.grade-details summary { 
      color: #3498db; 
      font-size: 0.9em; 
      font-weight: normal; 
    }
    details ul { 
      margin: 5px 0 0 20px; 
      padding: 0; 
      list-style-type: none; 
      font-size: 0.85em; 
      color: #7f8c8d; 
    }
    details ul li { 
      margin-bottom: 5px; 
    }
    .score-input {
      width: 30px;
      font-weight: bold;
      font-size: 1.2em;
      text-align: center;
      border: none;
      background: transparent;
    }
    .selected-display {
      display: none;
      margin-top: 5px;
      font-style: italic;
    }
    @media (max-width: 600px) {
      .question { 
        grid-template-columns: 1fr; 
        row-gap: 10px; 
      }
      .notes { 
        margin-top: 0; 
      }
      .buttons, .multi-select { 
        justify-content: center; 
      }
    }
    @media print {
      body { 
        background-color: #fff; 
        padding: 10px; 
        margin: 0; 
        font-size: 12pt; 
        color: #000; 
      }
      details.section { 
        border: none; 
        box-shadow: none; 
        padding: 10px 0; 
        page-break-inside: avoid; 
      }
      details.section > summary { 
        display: block; 
        font-weight: bold; 
        font-size: 14pt; 
        margin-bottom: 10px; 
        page-break-after: avoid; 
      }
      .question {
        display: block; 
        margin-bottom: 15px; 
        page-break-inside: avoid; 
      }
      .question label {
        display: block; 
        font-weight: bold; 
      }
      .buttons, .multi-select, .controls, select {
        display: none !important; 
      }
      .selected-display {
        display: block; 
      }
      input[type="text"], textarea {
        border: none; 
        border-bottom: 1px solid #000; 
        background: transparent; 
        width: 100%; 
        page-break-inside: avoid; 
        placeholder-color: transparent; 
      }
      input[type="text"]::placeholder, textarea::placeholder {
        color: transparent; 
      }
      textarea {
        height: auto; 
        min-height: 50px; 
      }
      .notes {
        margin-top: 10px; 
      }
      .score, .subscore {
        font-weight: bold; 
        page-break-before: avoid; 
      }
      .score-input {
        border: none; 
        background: transparent; 
        width: 40px; 
        text-align: center; 
        font-weight: bold; 
      }
      h1 {
        page-break-after: avoid; 
        text-align: center; 
        font-size: 18pt; 
      }
      details.grade-details[open] {
        display: block;
      }
      details.grade-details summary {
        display: block;
        font-size: 10pt;
        font-weight: bold;
      }
      details.section {
        margin-bottom: 20px;
      }
      .full-width-input {
        display: block;
      }
      #jsonFileInput {
        display: none;
      }
      .overall-question {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>
  <h1>Tactical Score Sheet</h1>

  <!-- Scenario and Evaluator Info -->
  <details class="section" open>
    <summary>Scenario and Evaluator Info</summary>
    <label title="Describe the scenario being evaluated">Scenario: 
      <input type="text" id="scenario" placeholder="Enter scenario..." />
    </label>
    <label title="Name of the candidate being evaluated">Candidate Name: <input type="text" id="candidateName" placeholder="Enter candidate name..." /></label>
    <label title="Name of the evaluator">Evaluator Name: <input type="text" id="evaluatorName" placeholder="Enter evaluator name..." /></label>
  </details>

  <!-- Initial Radio Report -->
  <details class="section" open>
    <summary>1. Initial Radio Report (12 pts)</summary>
    <div class="question">
      <label title="Was the incident address confirmed?">a) Incident Address Confirmed:</label>
      <div class="buttons">
        <button onclick="setScore('irr1', 2, this)">Yes</button>
        <button onclick="setScore('irr1', 0, this)">No</button>
      </div>
      <div class="selected-display" id="irr1-selected"></div>
      <span id="irr1-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('irr1', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="Notes..."></textarea>
    </div>
    <div class="question">
      <label title="Was the building size declared?">b) Building Size Declared:</label>
      <div class="buttons">
        <button onclick="setScore('irr2', 2, this)">Yes</button>
        <button onclick="setScore('irr2', 0, this)">No</button>
      </div>
      <div class="selected-display" id="irr2-selected"></div>
      <span id="irr2-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('irr2', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="Notes..."></textarea>
    </div>
    <div class="question">
      <label title="Was the building height declared?">c) Building Height Declared:</label>
      <div class="buttons">
        <button onclick="setScore('irr3', 2, this)">Yes</button>
        <button onclick="setScore('irr3', 0, this)">No</button>
      </div>
      <div class="selected-display" id="irr3-selected"></div>
      <span id="irr3-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('irr3', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="Notes..."></textarea>
    </div>
    <div class="question">
      <label title="Was the occupancy type declared?">d) Occupancy Type Declared:</label>
      <div class="buttons">
        <button onclick="setScore('irr4', 2, this)">Yes</button>
        <button onclick="setScore('irr4', 0, this)">No</button>
      </div>
      <div class="selected-display" id="irr4-selected"></div>
      <span id="irr4-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('irr4', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="Notes..."></textarea>
    </div>
    <div class="question">
      <label title="Describe the problem observed">e) Problem Description:</label>
      <div class="multi-select">
        <button onclick="toggleMultiSelect('irr5', this)">Light Smoke</button>
        <button onclick="toggleMultiSelect('irr5', this)">Working Fire</button>
        <button onclick="toggleMultiSelect('irr5', this)">Defensive Fire</button>
      </div>
      <div class="selected-display" id="irr5-selected"></div>
      <span id="irr5-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('irr5', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="Notes..."></textarea>
    </div>
    <div class="question">
      <label title="Specify the location of the problem">f) Location of Problem:</label>
      <input type="text" oninput="setScore('irr6', this.value ? 2 : 0)" placeholder="Enter location..." />
      <span id="irr6-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('irr6', this.value)">/2</span>
    </div>
    <div class="subscore" id="irr-subscore">Initial Radio Report Score: <span id="irr-total">0</span>/12</div>
  </details>

  <!-- IAP -->
  <details class="section" open>
    <summary>2. IAP (14 pts)</summary>
    <div class="question">
      <label title="Tasks assigned in the IAP">a) Tasks:</label>
      <div class="multi-select">
        <button onclick="toggleMultiSelect('iap1', this)">Supply Line</button>
        <button onclick="toggleMultiSelect('iap1', this)">Stretch</button>
        <button onclick="toggleMultiSelect('iap1', this)">Highrise Pack</button>
        <button onclick="toggleMultiSelect('iap1', this)">Quick Hit</button>
        <button onclick="toggleMultiSelect('iap1', this)">Defensive Ops</button>
      </div>
      <div class="selected-display" id="iap1-selected"></div>
      <span id="iap1-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('iap1', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="Notes..."></textarea>
    </div>
    <div class="question">
      <label title="Location specified in the IAP">b) Location:</label>
      <input type="text" oninput="setScore('iap2', this.value ? 2 : 0)" placeholder="Enter location..." />
      <span id="iap2-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('iap2', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="Notes..."></textarea>
    </div>
    <div class="question">
      <label title="Objectives of the IAP">c) Objectives:</label>
      <div class="multi-select">
        <button onclick="toggleMultiSelect('iap3', this)">Primary Search</button>
        <button onclick="toggleMultiSelect('iap3', this)">Fire Control</button>
        <button onclick="toggleMultiSelect('iap3', this)">Rescue</button>
      </div>
      <div class="selected-display" id="iap3-selected"></div>
      <span id="iap3-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('iap3', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="Notes..."></textarea>
    </div>
    <div class="question">
      <label title="Strategy chosen for the IAP">d) Strategy:</label>
      <div class="multi-select">
        <button onclick="toggleMultiSelect('iap4', this)">Offensive</button>
        <button onclick="toggleMultiSelect('iap4', this)">Defensive</button>
        <button onclick="toggleMultiSelect('iap4', this)">Investigating</button>
      </div>
      <div class="selected-display" id="iap4-selected"></div>
      <span id="iap4-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('iap4', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="Notes..."></textarea>
    </div>
    <div class="question">
      <label title="Did the candidate assume command?">e) Assume Command:</label>
      <div class="buttons">
        <button onclick="setScore('iap5', 2, this)">Yes</button>
        <button onclick="setScore('iap5', 0, this)">No</button>
      </div>
      <div class="selected-display" id="iap5-selected"></div>
      <span id="iap5-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('iap5', this.value)">/2</span>
    </div>
    <div class="question">
      <label title="Name assigned to the command">f) Command Name:</label>
      <input type="text" oninput="setScore('iap6', this.value ? 2 : 0)" placeholder="Enter command name..." />
      <span id="iap6-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('iap6', this.value)">/2</span>
    </div>
    <div class="question">
      <label title="Were resources determined?">g) Resource Determination:</label>
      <div class="buttons">
        <button onclick="setScore('iap7', 2, this)">Yes</button>
        <button onclick="setScore('iap7', 0, this)">No</button>
      </div>
      <div class="selected-display" id="iap7-selected"></div>
      <span id="iap7-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('iap7', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="Notes..."></textarea>
    </div>
    <div class="subscore" id="iap-subscore">IAP Score: <span id="iap-total">0</span>/14</div>
  </details>

  <!-- Follow Up Report -->
  <details class="section" open>
    <summary>3. Follow Up Report (10 pts)</summary>
    <div class="question">
      <label title="Was a 360-degree assessment completed?">a) Results of 360:</label>
      <div class="buttons">
        <button onclick="setScore('fur1', 2, this)">Completed</button>
        <button onclick="setScore('fur1', 0, this)">No</button>
      </div>
      <div class="selected-display" id="fur1-selected"></div>
      <span id="fur1-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('fur1', this.value)">/2</span>
    </div>
    <div class="question">
      <label title="Type of basement identified">b) Basement Type:</label>
      <div class="multi-select">
        <button onclick="toggleMultiSelect('fur2', this)">No Basement</button>
        <button onclick="toggleMultiSelect('fur2', this)">Look Out</button>
        <button onclick="toggleMultiSelect('fur2', this)">Walk Out</button>
        <button onclick="toggleMultiSelect('fur2', this)">Window Well</button>
      </div>
      <div class="selected-display" id="fur2-selected"></div>
      <span id="fur2-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('fur2', this.value)">/2</span>
    </div>
    <div class="question">
      <label title="Were changes made to the IAP?">c) Changes to IAP:</label>
      <div class="buttons">
        <button onclick="setScore('fur3', 2, this)">Yes</button>
        <button onclick="setScore('fur3', 2, this)">No</button>
        <button onclick="setScore('fur3', 0, this)">Not Stated</button>
      </div>
      <div class="selected-display" id="fur3-selected"></div>
      <span id="fur3-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('fur3', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="Document IAP changes..."></textarea>
    </div>
    <div class="question">
      <label title="Location where accountability is maintained">d) Accountability Location:</label>
      <div class="multi-select">
        <button onclick="toggleMultiSelect('fur4', this)">ALPHA</button>
        <button onclick="toggleMultiSelect('fur4', this)">BRAVO</button>
        <button onclick="toggleMultiSelect('fur4', this)">CHARLIE</button>
        <button onclick="toggleMultiSelect('fur4', this)">DELTA</button>
      </div>
      <div class="selected-display" id="fur4-selected"></div>
      <span id="fur4-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('fur4', this.value)">/2</span>
    </div>
    <div class="question">
      <label title="Was the tactical channel confirmed?">e) Confirm TAC Channel:</label>
      <div class="buttons">
        <button onclick="setScore('fur5', 2, this)">Yes</button>
        <button onclick="setScore('fur5', 0, this)">No</button>
      </div>
      <div class="selected-display" id="fur5-selected"></div>
      <span id="fur5-score"><input type="number" min="0" max="2" value="0" class="score-input" onchange="setManualScore('fur5', this.value)">/2</span>
      <textarea class="notes" rows="2" placeholder="TAC Channel used..."></textarea>
    </div>
    <div class="subscore" id="fur-subscore">Follow Up Report Score: <span id="fur-total">0</span>/10</div>
  </details>

  <!-- First Unit Assignment -->
  <details class="section" open>
    <summary>4. First Unit Assignment (4 pts)</summary>
    <div class="question">
      <label title="Unit assigned for the first task">a) Unit:</label>
      <select onchange="setScore('fua1', this.value ? 1 : 0)">
        <option value="">Select Unit</option>
        <option value="E-1">E-1</option>
        <option value="E-2">E-2</option>
        <option value="E-4">E-4</option>
        <option value="E-5">E-5</option>
        <option value="E-6">E-6</option>
        <option value="Sq-4">Sq-4</option>
        <option value="L-1">L-1</option>
        <option value="L-2">L-2</option>
      </select>
      <span id="fua1-score"><input type="number" min="0" max="1" value="0" class="score-input" onchange="setManualScore('fua1', this.value)">/1</span>
    </div>
    <div class="question">
      <label title="Task assigned to the first unit">b) Task:</label>
      <div class="buttons">
        <button onclick="toggleNotCompleted('fua2', this)">Not Completed</button>
      </div>
      <div class="selected-display" id="fua2-selected"></div>
      <span id="fua2-score"><input type="number" min="0" max="1" value="0" class="score-input" onchange="setManualScore('fua2', this.value)">/1</span>
      <input type="text" class="full-width-input" oninput="updateFuaSuaScore('fua2')" placeholder="Enter task..." />
    </div>
    <div class="question">
      <label title="Location for the first unit">c) Location:</label>
      <div class="buttons">
        <button onclick="toggleNotCompleted('fua3', this)">Not Completed</button>
      </div>
      <div class="selected-display" id="fua3-selected"></div>
      <span id="fua3-score"><input type="number" min="0" max="1" value="0" class="score-input" onchange="setManualScore('fua3', this.value)">/1</span>
      <input type="text" class="full-width-input" oninput="updateFuaSuaScore('fua3')" placeholder="Enter location..." />
    </div>
    <div class="question">
      <label title="Objective for the first unit">d) Objective:</label>
      <div class="buttons">
        <button onclick="toggleNotCompleted('fua4', this)">Not Completed</button>
      </div>
      <div class="selected-display" id="fua4-selected"></div>
      <span id="fua4-score"><input type="number" min="0" max="1" value="0" class="score-input" onchange="setManualScore('fua4', this.value)">/1</span>
      <input type="text" class="full-width-input" oninput="updateFuaSuaScore('fua4')" placeholder="Enter objective..." />
    </div>
    <div class="subscore" id="fua-subscore">First Unit Score: <span id="fua-total">0</span>/4</div>
  </details>

  <!-- Second Unit Assignment -->
  <details class="section" open>
    <summary>5. Second Unit Assignment (4 pts)</summary>
    <div class="question">
      <label title="Unit assigned for the second task">a) Unit:</label>
      <select onchange="setScore('sua1', this.value ? 1 : 0)">
        <option value="">Select Unit</option>
        <option value="E-1">E-1</option>
        <option value="E-2">E-2</option>
        <option value="E-4">E-4</option>
        <option value="E-5">E-5</option>
        <option value="E-6">E-6</option>
        <option value="Sq-4">Sq-4</option>
        <option value="L-1">L-1</option>
        <option value="L-2">L-2</option>
      </select>
      <span id="sua1-score"><input type="number" min="0" max="1" value="0" class="score-input" onchange="setManualScore('sua1', this.value)">/1</span>
    </div>
    <div class="question">
      <label title="Task assigned to the second unit">b) Task:</label>
      <div class="buttons">
        <button onclick="toggleNotCompleted('sua2', this)">Not Completed</button>
      </div>
      <div class="selected-display" id="sua2-selected"></div>
      <span id="sua2-score"><input type="number" min="0" max="1" value="0" class="score-input" onchange="setManualScore('sua2', this.value)">/1</span>
      <input type="text" class="full-width-input" oninput="updateFuaSuaScore('sua2')" placeholder="Enter task..." />
    </div>
    <div class="question">
      <label title="Location for the second unit">c) Location:</label>
      <div class="buttons">
        <button onclick="toggleNotCompleted('sua3', this)">Not Completed</button>
      </div>
      <div class="selected-display" id="sua3-selected"></div>
      <span id="sua3-score"><input type="number" min="0" max="1" value="0" class="score-input" onchange="setManualScore('sua3', this.value)">/1</span>
      <input type="text" class="full-width-input" oninput="updateFuaSuaScore('sua3')" placeholder="Enter location..." />
    </div>
    <div class="question">
      <label title="Objective for the second unit">d) Objective:</label>
      <div class="buttons">
        <button onclick="toggleNotCompleted('sua4', this)">Not Completed</button>
      </div>
      <div class="selected-display" id="sua4-selected"></div>
      <span id="sua4-score"><input type="number" min="0" max="1" value="0" class="score-input" onchange="setManualScore('sua4', this.value)">/1</span>
      <input type="text" class="full-width-input" oninput="updateFuaSuaScore('sua4')" placeholder="Enter objective..." />
    </div>
    <div class="subscore" id="sua-subscore">Second Unit Score: <span id="sua-total">0</span>/4</div>
  </details>

  <!-- Transferred Command -->
  <details class="section" open>
    <summary>6. Transferred Command Accurately (6 pts)</summary>
    <div class="question">
      <label title="Was command transferred accurately?">Transferred Command:</label>
      <div class="buttons">
        <button onclick="setScore('tc', 6, this)">Yes</button>
        <button onclick="setScore('tc', 0, this)">No</button>
      </div>
      <div class="selected-display" id="tc-selected"></div>
      <span id="tc-score"><input type="number" min="0" max="6" value="0" class="score-input" onchange="setManualScore('tc', this.value)">/6</span>
      <textarea class="notes" rows="2" placeholder="Notes..."></textarea>
    </div>
    <div class="subscore" id="tc-subscore">Transferred Command Score: <span id="tc-total">0</span>/6</div>
  </details>

  <!-- Follow-up Questions -->
  <details class="section" open>
    <summary>Follow-up Questions</summary>
    <div class="question">
      <label title="Explain the reasoning behind the chosen strategy and tactics">1. Why did you choose this strategy and tactics?</label>
      <textarea class="notes" rows="5" id="q1" placeholder="Enter response..."></textarea>
    </div>
    <div class="question">
      <label title="Reflect on potential improvements">2. Anything you would change or do differently?</label>
      <textarea class="notes" rows="5" id="q2" placeholder="Enter response..."></textarea>
    </div>
  </details>

  <!-- Overall Impression -->
  <details class="section" open>
    <summary>Overall Impression (50 pts)</summary>
    <div class="overall-question">
      <div class="question">
        <label title="Assess the candidate's competence">a) Competence (0-10):</label>
        <select onchange="setScore('oi1', this.value)">
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
        <span id="oi1-score"><input type="number" min="0" max="10" value="0" class="score-input" onchange="setManualScore('oi1', this.value)">/10</span>
      </div>
      <details class="grade-details">
        <summary>Grade Justifications</summary>
        <ul>
          <li>1-3: The candidate somewhat recognizes firefighters’ abilities and gives assignments.</li>
          <li>3-7: The candidate recognizes firefighters’ abilities and gives assignments to utilize those abilities.</li>
          <li>7-10: The candidate strongly recognizes firefighters’ abilities and gives assignments to fully utilize those abilities.</li>
        </ul>
      </details>
      <textarea class="notes" rows="2" placeholder="Notes on Competence..."></textarea>
    </div>
    <div class="overall-question">
      <div class="question">
        <label title="Assess the candidate's decisiveness">b) Decisiveness (0-10):</label>
        <select onchange="setScore('oi2', this.value)">
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
        <span id="oi2-score"><input type="number" min="0" max="10" value="0" class="score-input" onchange="setManualScore('oi2', this.value)">/10</span>
      </div>
      <details class="grade-details">
        <summary>Grade Justifications</summary>
        <ul>
          <li>1-3: There is some wavering about decision-making; the Candidate is unsure about what needs to be accomplished and by whom.</li>
          <li>3-7: There is little to no wavering about decision-making; the Candidate is determined about what needs to be accomplished and by whom.</li>
          <li>7-10: There is no wavering about decision-making; the Candidate is determined and forceful about what needs to be accomplished and by whom.</li>
        </ul>
      </details>
      <textarea class="notes" rows="2" placeholder="Notes on Decisiveness..."></textarea>
    </div>
    <div class="overall-question">
      <div class="question">
        <label title="Assess the candidate's self-confidence">c) Self Confidence (0-10):</label>
        <select onchange="setScore('oi3', this.value)">
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
        <span id="oi3-score"><input type="number" min="0" max="10" value="0" class="score-input" onchange="setManualScore('oi3', this.value)">/10</span>
      </div>
      <details class="grade-details">
        <summary>Grade Justifications</summary>
        <ul>
          <li>1-3: The candidate is unsure of himself. Limited to no confidence during the scenario.</li>
          <li>3-7: The candidate has good composure. Demonstrates some calmness and confidence during the scenario.</li>
          <li>7-10: The candidate has great composure and a high level of calmness during the scenario.</li>
        </ul>
      </details>
      <textarea class="notes" rows="2" placeholder="Notes on Self Confidence..."></textarea>
    </div>
    <div class="overall-question">
      <div class="question">
        <label title="Assess the candidate's goal orientation">d) Goal Oriented (0-10):</label>
        <select onchange="setScore('oi4', this.value)">
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
        <span id="oi4-score"><input type="number" min="0" max="10" value="0" class="score-input" onchange="setManualScore('oi4', this.value)">/10</span>
      </div>
      <details class="grade-details">
        <summary>Grade Justifications</summary>
        <ul>
          <li>1-3: The Candidate can somewhat achieve tactical priorities and remains somewhat aware of the safety of firefighters.</li>
          <li>3-7: The Candidate achieves tactical priorities and remains aware of the safety of firefighters.</li>
          <li>7-10: The Candidate can shift into a higher gear to achieve tactical priorities and be constantly protective of the safety of firefighters.</li>
        </ul>
      </details>
      <textarea class="notes" rows="2" placeholder="Notes on Goal Oriented..."></textarea>
    </div>
    <div class="overall-question">
      <div class="question">
        <label title="Assess the candidate's communication skills">e) Communication (0-10):</label>
        <select onchange="setScore('oi5', this.value)">
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
        <span id="oi5-score"><input type="number" min="0" max="10" value="0" class="score-input" onchange="setManualScore('oi5', this.value)">/10</span>
      </div>
      <details class="grade-details">
        <summary>Grade Justifications</summary>
        <ul>
          <li>1-3: The Candidate’s communication isn’t clear or direct. The candidate fails to use common terminology. Little to no command presence.</li>
          <li>3-7: The Candidate’s communication is somewhat clear. The candidate uses mostly common terminology and is somewhat articulate. Some command presence.</li>
          <li>7-10: The Candidate’s communication is clear and direct. The candidate uses common terminology and is very articulate. Strong command presence.</li>
        </ul>
      </details>
      <textarea class="notes" rows="2" placeholder="Notes on Communication..."></textarea>
    </div>
    <div class="subscore" id="oi-subscore">Overall Impression Score: <span id="oi-total">0</span>/50</div>
  </details>

  <!-- Additional Notes/Comments -->
  <details class="section" open>
    <summary>Additional Notes/Comments</summary>
    <textarea rows="5" id="notes" placeholder="Enter additional notes..."></textarea>
  </details>

  <!-- Total Score and Controls -->
  <div class="score">Total Score: <span id="totalScore">0</span>/100</div>
  <div class="controls">
    <button onclick="downloadPDF()">Download PDF</button>
    <button onclick="resetForm()">Reset Form</button>
    <button onclick="saveToJSON()">Save as JSON</button>
    <button onclick="document.getElementById('jsonFileInput').click()">Open JSON</button>
    <input type="file" id="jsonFileInput" style="display: none;" accept=".json" onchange="loadFromJSON(event)">
  </div>

  <script>
    const { jsPDF } = window.jspdf;
    const scores = {
      irr1: 0, irr2: 0, irr3: 0, irr4: 0, irr5: 0, irr6: 0,
      iap1: 0, iap2: 0, iap3: 0, iap4: 0, iap5: 0, iap6: 0, iap7: 0,
      fur1: 0, fur2: 0, fur3: 0, fur4: 0, fur5: 0,
      fua1: 0, fua2: 0, fua3: 0, fua4: 0,
      sua1: 0, sua2: 0, sua3: 0, sua4: 0,
      tc: 0,
      oi1: 0, oi2: 0, oi3: 0, oi4: 0, oi5: 0
    };

    function getMaxPoints(key) {
      if (key === 'tc') return 6;
      if (key.startsWith('oi')) return 10;
      if (key.startsWith('fua') || key.startsWith('sua')) return 1;
      return 2;
    }

    function setScore(key, value, button = null) {
      scores[key] = Number(value);
      const scoreSpan = document.getElementById(`${key}-score`);
      const input = scoreSpan.querySelector('input');
      input.value = scores[key];
      if (button) {
        const group = button.parentNode.querySelectorAll('button');
        group.forEach(btn => btn.classList.remove('selected'));
        button.classList.add('selected');
        document.getElementById(`${key}-selected`).textContent = button.textContent;
      }
      updateScore();
    }

    function setManualScore(key, value) {
      const maxPoints = getMaxPoints(key);
      const numValue = Math.min(Math.max(Number(value), 0), maxPoints);
      scores[key] = numValue;
      updateScore();
    }

    function toggleMultiSelect(key, button) {
      button.classList.toggle('selected');
      const buttons = button.parentNode.querySelectorAll('button');
      const selected = Array.from(buttons).filter(btn => btn.classList.contains('selected')).map(b => b.textContent).join(', ');
      document.getElementById(`${key}-selected`).textContent = selected;
      const selectedCount = Array.from(buttons).filter(btn => btn.classList.contains('selected')).length;
      const maxPoints = getMaxPoints(key);
      setScore(key, selectedCount > 0 ? maxPoints : 0);
    }

    function toggleNotCompleted(key, button) {
      button.classList.toggle('selected');
      document.getElementById(`${key}-selected`).textContent = button.classList.contains('selected') ? button.textContent : '';
      updateFuaSuaScore(key);
    }

    function updateFuaSuaScore(key) {
      const button = document.querySelector(`#${key}-score`).parentNode.querySelector('.buttons button');
      const textInput = document.querySelector(`#${key}-score`).parentNode.querySelector('input[type="text"]');
      const isNotCompleted = button && button.classList.contains('selected');
      const hasText = textInput && textInput.value.trim() !== '';
      const newScore = isNotCompleted ? 0 : (hasText ? getMaxPoints(key) : 0);
      setScore(key, newScore);
    }

    function updateScore() {
      let total = 0;
      let irrTotal = 0, iapTotal = 0, furTotal = 0, fuaTotal = 0, suaTotal = 0, tcTotal = 0, oiTotal = 0;

      irrTotal = scores.irr1 + scores.irr2 + scores.irr3 + scores.irr4 + scores.irr5 + scores.irr6;
      iapTotal = scores.iap1 + scores.iap2 + scores.iap3 + scores.iap4 + scores.iap5 + scores.iap6 + scores.iap7;
      furTotal = scores.fur1 + scores.fur2 + scores.fur3 + scores.fur4 + scores.fur5;
      fuaTotal = scores.fua1 + scores.fua2 + scores.fua3 + scores.fua4;
      suaTotal = scores.sua1 + scores.sua2 + scores.sua3 + scores.sua4;
      tcTotal = scores.tc;
      oiTotal = scores.oi1 + scores.oi2 + scores.oi3 + scores.oi4 + scores.oi5;

      document.getElementById('irr-total').innerText = irrTotal;
      document.getElementById('iap-total').innerText = iapTotal;
      document.getElementById('fur-total').innerText = furTotal;
      document.getElementById('fua-total').innerText = fuaTotal;
      document.getElementById('sua-total').innerText = suaTotal;
      document.getElementById('tc-total').innerText = tcTotal;
      document.getElementById('oi-total').innerText = oiTotal;

      total = irrTotal + iapTotal + furTotal + fuaTotal + suaTotal + tcTotal + oiTotal;
      document.getElementById('totalScore').innerText = total;

      updateSubscoreColors();
    }

    function updateSubscoreColors() {
      const subscores = [
        {el: document.getElementById('irr-subscore'), scoreId: 'irr-total', max: 12},
        {el: document.getElementById('iap-subscore'), scoreId: 'iap-total', max: 14},
        {el: document.getElementById('fur-subscore'), scoreId: 'fur-total', max: 10},
        {el: document.getElementById('fua-subscore'), scoreId: 'fua-total', max: 4},
        {el: document.getElementById('sua-subscore'), scoreId: 'sua-total', max: 4},
        {el: document.getElementById('tc-subscore'), scoreId: 'tc-total', max: 6},
        {el: document.getElementById('oi-subscore'), scoreId: 'oi-total', max: 50}
      ];
      subscores.forEach(s => {
        const score = Number(document.getElementById(s.scoreId).innerText);
        const percentage = (score / s.max) * 100;
        s.el.classList.remove('red', 'yellow', 'green');
        if (percentage < 50) s.el.classList.add('red');
        else if (percentage <= 75) s.el.classList.add('yellow');
        else s.el.classList.add('green');
      });
    }

    function downloadPDF() {
      const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'letter'
      });

      const marginLeft = 10;
      const marginTop = 10;
      const lineHeight = 6;
      let y = marginTop;

      function checkPageBreak(currentY, spaceNeeded) {
        if (currentY + spaceNeeded > 279 - 10) {
          doc.addPage();
          return marginTop;
        }
        return currentY;
      }

      doc.setFontSize(16);
      doc.setFont('helvetica', 'bold');
      doc.text('Tactical Score Sheet', 105, y, { align: 'center' });
      y += lineHeight * 2;

      doc.setFontSize(12);
      doc.setFont('helvetica', 'bold');
      y = checkPageBreak(y, lineHeight * 4);
      doc.text('Scenario and Evaluator Info', marginLeft, y);
      y += lineHeight;
      doc.setFont('helvetica', 'normal');
      doc.text(`Scenario: ${document.getElementById('scenario').value || 'N/A'}`, marginLeft + 5, y);
      y += lineHeight;
      doc.text(`Candidate Name: ${document.getElementById('candidateName').value || 'N/A'}`, marginLeft + 5, y);
      y += lineHeight;
      doc.text(`Evaluator Name: ${document.getElementById('evaluatorName').value || 'N/A'}`, marginLeft + 5, y);
      y += lineHeight * 2;

      const sections = document.querySelectorAll('details.section');
      sections.forEach((section, index) => {
        if (index > 0) {
          const title = section.querySelector('summary').innerText;
          const questions = section.querySelectorAll('.question');
          const subscore = section.querySelector('.subscore')?.innerText.replace(/<[^>]*>/g, '') || '';
          const subscoreValue = section.querySelector('.subscore span')?.innerText || '';

          doc.setFontSize(12);
          doc.setFont('helvetica', 'bold');
          y = checkPageBreak(y, lineHeight * (questions.length + 5));
          doc.text(title, marginLeft, y);
          y += lineHeight;

          doc.setFontSize(10);
          doc.setFont('helvetica', 'normal');
          questions.forEach(question => {
            const label = question.querySelector('label').innerText.replace(/:/g, '');
            const score = question.querySelector('.score-input').value + question.querySelector('span').innerText.split('/')[1];
            let selected = question.querySelector('.selected-display').textContent || '';
            const textInput = question.querySelector('input[type="text"]') ?.value || '';
            const notes = question.querySelector('.notes') ?.value || '';
            const selectValue = question.querySelector('select') ?.value || '';

            y = checkPageBreak(y, lineHeight * 5);
            doc.text(`${label}:`, marginLeft + 5, y);
            y += lineHeight;
            if (selected) doc.text(selected, marginLeft + 10, y), y += lineHeight;
            if (selectValue && selectValue !== '') doc.text(selectValue, marginLeft + 10, y), y += lineHeight;
            if (textInput) doc.text(textInput, marginLeft + 10, y), y += lineHeight;
            doc.text(score, marginLeft + 10, y - lineHeight * (selected || selectValue || textInput ? 1 : 0) - 3); // adjust position for score
            if (notes) {
              doc.text('Notes: ', marginLeft + 10, y);
              y += lineHeight;
              const notesLines = doc.splitTextToSize(notes, 180);
              doc.text(notesLines, marginLeft + 15, y);
              y += lineHeight * notesLines.length;
            }
            y += lineHeight;
          });

          if (subscore) {
            doc.setFont('helvetica', 'bold');
            doc.text(`${subscore.replace(subscoreValue, '')}${subscoreValue}`, marginLeft + 5, y);
            y += lineHeight * 2;
          }
        }
      });

      const totalScore = document.getElementById('totalScore').innerText;
      doc.setFontSize(12);
      doc.setFont('helvetica', 'bold');
      y = checkPageBreak(y, lineHeight);
      doc.text(`Total Score: ${totalScore}/100`, marginLeft, y);

      doc.save(`Tactical_Score_Sheet_${document.getElementById('scenario').value || 'Untitled'}_${Date.now()}.pdf`);
    }

    function resetForm() {
      for (const key in scores) {
        scores[key] = 0;
      }
      document.querySelectorAll('.score-input').forEach(input => input.value = 0);
      document.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
      document.querySelectorAll('.selected-display').forEach(div => div.textContent = '');
      document.querySelectorAll('input[type="text"], textarea').forEach(input => input.value = '');
      document.querySelectorAll('select').forEach(select => select.value = '');
      updateScore();
    }

    function saveToJSON() {
      const data = {
        scores: { ...scores },
        inputs: {
          scenario: document.getElementById('scenario').value,
          candidateName: document.getElementById('candidateName').value,
          evaluatorName: document.getElementById('evaluatorName').value
        },
        selected: {},
        textareas: {},
        selects: {}
      };

      document.querySelectorAll('.selected-display').forEach(div => {
        const key = div.id.replace('-selected', '');
        data.selected[key] = div.textContent;
      });

      document.querySelectorAll('textarea').forEach(ta => {
        if (ta.id) data.textareas[ta.id] = ta.value;
      });

      document.querySelectorAll('select').forEach(select => {
        const key = select.closest('.question').querySelector('span').id.replace('-score', '');
        data.selects[key] = select.value;
      });

      document.querySelectorAll('input[type="text"]').forEach(input => {
        const key = input.closest('.question') ?.querySelector('span') ?.id.replace('-score', '');
        if (key) data.inputs[key] = input.value;
      });

      const jsonStr = JSON.stringify(data, null, 2);
      const blob = new Blob([jsonStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Tactical_Score_Sheet_${data.inputs.scenario || 'Untitled'}_${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function loadFromJSON(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          resetForm();

          Object.assign(scores, data.scores);
          for (const key in scores) {
            const input = document.querySelector(`#${key}-score .score-input`);
            if (input) input.value = scores[key];
          }

          document.getElementById('scenario').value = data.inputs.scenario || '';
          document.getElementById('candidateName').value = data.inputs.candidateName || '';
          document.getElementById('evaluatorName').value = data.inputs.evaluatorName || '';

          for (const key in data.selected) {
            document.getElementById(`${key}-selected`).textContent = data.selected[key];
            const buttons = document.querySelectorAll(`#${key}-selected`).previousElementSibling.querySelectorAll('button');
            buttons.forEach(btn => {
              if (data.selected[key].includes(btn.textContent)) btn.classList.add('selected');
            });
          }

          for (const key in data.textareas) {
            document.getElementById(key).value = data.textareas[key];
          }

          for (const key in data.selects) {
            const select = document.querySelector(`#${key}-score`).parentNode.querySelector('select');
            if (select) select.value = data.selects[key];
            scores[key] = Number(data.selects[key]);
          }

          for (const key in data.inputs) {
            if (!['scenario', 'candidateName', 'evaluatorName'].includes(key)) {
              const input = document.querySelector(`#${key}-score`).parentNode.querySelector('input[type="text"]');
              if (input) input.value = data.inputs[key];
            }
          }

          updateScore();
        } catch (error) {
          alert('Error loading JSON file: ' + error.message);
        }
      };
      reader.readAsText(file);
    }

    window.onload = function() {
      resetForm();
    };
  </script>
</body>
</html>
